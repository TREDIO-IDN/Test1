<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Trading System</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#111;color:white;font-family:Arial;margin:0;padding:0}
#loginScreen,#mainApp{padding:15px}
.btn{padding:10px 18px;border:none;border-radius:6px;font-size:16px;cursor:pointer}
.green{background:#2ecc71}
.red{background:#e74c3c}
.box{padding:8px;margin-top:10px;background:#1e1e1e;border-radius:6px}
</style>
</head>

<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <h2>Login</h2>
  <input id="loginUser" placeholder="Username"><br><br>
  <input id="loginPass" type="password" placeholder="Password"><br><br>
  <button id="btnLogin" class="btn green">Login</button>
  <div id="loginError" style="color:red;display:none;margin-top:10px">Login Salah!</div>
</div>



<!-- MAIN APP -->
<div id="mainApp" style="display:none">
  
  <h2>Harga Sekarang: <span id="txtNow">0.000</span></h2>
  <canvas id="chartCanvas" height="180"></canvas>

  <h3>Taruhan</h3>

  <button class="btn green" id="btnUp">TARUHAN NAIK</button>
  <button class="btn red" id="btnDown">TARUHAN TURUN</button>

  <div id="orderBox" class="box" style="display:none">
    <h3>üìù Detail Order</h3>
    Harga Buka: <span id="openPrice"></span><br>
    Jam Mulai: <span id="startTime"></span><br>
    Jam Selesai: <span id="endTime"></span><br>
    Arah: <span id="orderDir"></span>
  </div>

</div>



<script>
/* ============================================================
   VARIABEL GLOBAL
   ============================================================ */
let chart, chartInterval = null;
let soundEnabled = false;
let audioCtx = null;


/* ============================================================
   LOGIN
   ============================================================ */
document.getElementById('btnLogin').onclick = ()=>{

  const u = loginUser.value.trim();
  const p = loginPass.value.trim();

  if(u==="TRADERPRO2025" && p==="120288"){
      
      // sukses login
      loginScreen.style.display = "none";
      mainApp.style.display = "block";

      // baru aktifkan suara
      soundEnabled = true;

      // mulai grafik
      startChartLoop();
  } 
  else {
      loginError.style.display = "block";
  }
};



/* ============================================================
   CHART
   ============================================================ */
const ctx = document.getElementById("chartCanvas").getContext("2d");

chart = new Chart(ctx,{
  type:"line",
  data:{
    labels:[],
    datasets:[{
      data:[],
      borderColor:"#2ecc71",
      borderWidth:2,
      pointRadius:0
    }]
  },
  options:{
    animation:false,
    scales:{
      x:{
        ticks:{color:"#bbb", autoSkip:true, maxTicksLimit:6},
        grid:{color:"#222"}
      },
      y:{
        ticks:{color:"#bbb"},
        grid:{color:"#222"}
      }
    },
    plugins:{ legend:{display:false} }
  }
});


function pushPoint(){
  const now = new Date();
  const hh = now.getHours().toString().padStart(2,"0");
  const mm = now.getMinutes().toString().padStart(2,"0");

  const price = 75 + (Math.random()-0.5)*0.05;

  chart.data.labels.push(`${hh}:${mm}`);
  chart.data.datasets[0].data.push(price);

  if(chart.data.labels.length > 300){
    chart.data.labels.shift();
    chart.data.datasets[0].data.shift();
  }

  txtNow.textContent = price.toFixed(3);
  chart.update('none');
}


/* ============================================================
   SUARA
   ============================================================ */
function playTick(){
  if(!soundEnabled) return;

  if(!audioCtx){
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  }

  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.frequency.value = 1000;
  gain.gain.value = 0.04;

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + 0.1);
}


/* ============================================================
   START LOOP SETELAH LOGIN
   ============================================================ */
function startChartLoop(){
  if(chartInterval) return;
  chartInterval = setInterval(()=>{
    pushPoint();
    playTick();
  },1000);
}



/* ============================================================
   TARUHAN ‚Äî MINIMAL 2 MENIT
   ============================================================ */
function formatHHMMSS(date){
  let h = date.getHours().toString().padStart(2,"0");
  let m = date.getMinutes().toString().padStart(2,"0");
  let s = date.getSeconds().toString().padStart(2,"0");
  return `${h}:${m}:${s}`;
}

function getEndTime(start, durMin){
  let end = new Date(start.getTime() + durMin*60000);

  // pembulatan detik ke "00"
  if(end.getSeconds() !== 0){
      end.setMinutes(end.getMinutes()+1);
      end.setSeconds(0);
  }
  return end;
}

function placeOrder(direction){
  const now = new Date();
  const open = parseFloat(txtNow.textContent);

  const end = getEndTime(now, 2); // minimal 2 menit

  openPrice.textContent = open.toFixed(3);
  startTime.textContent = formatHHMMSS(now);
  endTime.textContent = formatHHMMSS(end);
  orderDir.textContent = direction;

  orderBox.style.display = "block";
}

document.getElementById("btnUp").onclick = ()=>placeOrder("NAIK");
document.getElementById("btnDown").onclick = ()=>placeOrder("TURUN");

</script>

</body>
</html>
